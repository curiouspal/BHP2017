---
title: "Comparison between Out-movers, New-comers and the Core group"
date: January 16, 2018
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE, echo=FALSE, message=FALSE}
load("/media/anirban/a84ef5e0-59cf-454d-aeae-e112c9915900/home/anirban/Documents/BHP-New/BHP-2017-roundData/combined-Jan16-2018.RData")
admin2017 <- read.csv("/media/anirban/a84ef5e0-59cf-454d-aeae-e112c9915900/home/anirban/Documents/BHP-New/BHP-2017-roundData/admin2017.csv")
admin2015 <- read.csv("/media/anirban/a84ef5e0-59cf-454d-aeae-e112c9915900/home/anirban/Documents/BoulderHousingPartnersData/Data/BHP-Admin_records/2015-additionalDataSurveyRespondents-revised2.csv", header=TRUE)
#grep(" ", admin2015$T.code, value = TRUE)
final <- subset(final, PH_or_S8=="PH")
admin2015$T.code <- gsub(" ", "", admin2015$T.code, ignore.case = FALSE, perl = FALSE, useBytes = FALSE)
admin2017$T.code <- gsub(" ", "", admin2017$Tenant, ignore.case = FALSE, perl = FALSE, useBytes = FALSE)
#grep(" ", final$TCode, value = TRUE)
admin2017$T.code[admin2017$T.code==""] <- NA

names(final)[names(final)=="MemberCitizen_17"] <- "Member.Citizen_17"
names(final)[names(final)=="Member.Citizen15"] <- "Member.Citizen_15"
final$Member.Citizen_15[is.na(final$Member.Citizen_15)] <- final$Member.Citizen_17[is.na(final$Member.Citizen_15)]
final$Member.Citizen_17[is.na(final$Member.Citizen_17)] <- final$Member.Citizen_15[is.na(final$Member.Citizen_17)]
#summary(as.factor(final$From.y))
#summary(as.factor(final$From.x))
final <- subset(final, !is.na(final$From.y) | !is.na(final$From15) | !is.na(Bedrooms_14))
final <- subset(final, !is.na(final$TCode))
library("ggplot2")
library("plyr")
#library("dplyr")
#library("pander")
library("reshape2")
library("scales")

#panderOptions("table.split.table", Inf)

```

Core group N:
```{r, echo=FALSE}
#summary(as.factor(final$From.y))


names(admin2015)[2] <- "TCode"
#for(i in 3:length(names(admin2015))) names(admin2015)[i] <- paste0(names(admin2015)[i], "_15", sep="")
final$FromAdmin_17[final$TCode %in% admin2017$Tenant[!is.na(admin2017$Tenant) & admin2017$Tenant!=""]] <- "admin2017"
final$FromAdmin_15[final$TCode %in% levels(as.factor(admin2015$TCode))] <- "admin2015"
final$FromAdmin_14[final$TCode %in% final$TCode[!is.na(final$Bedrooms_14)]] <- "admin2014"

#final <- merge(final, admin2015, by = intersect(names(final), names(admin2015)), all = FALSE)

#s2017 <- final$TCode[final$From.y=="phadmin2017" & !is.na(final$From.y)]
#s2015 <- final$TCode[!is.na(final$FromAdmin_15)]
s2017 <- levels(as.factor(final$TCode[final$FromAdmin_17=="admin2017"]))
s2015 <- levels(as.factor(final$TCode[final$FromAdmin_15=="admin2015"]))
s2014 <- levels(as.factor(final$TCode[final$FromAdmin_14=="admin2014"]))

#final$From_15[final$TCode %in% s2015]
#summary(as.factor(final$Surveyed_14[final$TCode %in% s2014]))

#setdiff(s2014, s2015)
#setdiff(s2017, s2015)
#intersect(s2017, s2014)

rest1 <- intersect(s2017, s2015)
#rest1

rest <- subset(final, TCode %in% rest1)

length(rest$TCode)

```

New move-in group N:
```{r, echo=FALSE}
new1 <- setdiff(s2017, s2015)
#new1

new <- subset(final, TCode %in% new1)
length(new$TCode)
```

Out-movers group N:
```{r, echo=FALSE}
outmovers2017 <- read.csv("/media/anirban/a84ef5e0-59cf-454d-aeae-e112c9915900/home/anirban/Documents/BHP-New/BHP-2017-roundData/admin_outmovers2017.csv")
attrition1 <- setdiff(s2015, s2017)
#attrition1
out_2 <- as.character(outmovers2017$Tenant)

attrition <- subset(final, TCode %in% attrition1)

#intersect(final$TCode, attrition1)
length(attrition$TCode)
```


```{r, echo=FALSE}
rest$F <- "Core"
new$F <- "New"
attrition$F <- "Out"
all <- rbind(rest, attrition, new)
all$F <- as.factor(all$F)
#summary(all$F)


Q <- c("Q1","Q2","Q3_1","Q3_2","Q3_3","Q3_4","Q3_5","Q3_6","Q3_7","Q3_8","Q3_9","Q4","Q5","Q6","Q7","Q8_1_1","Q8_1_2","Q8_1_3","Q8_1_4","Q8_1_5","Q8_1_6","Q8_1_7","Q8_1_8","Q8_1_9","Q8_1_10","Q8_1_11","Q8_1_12","Q8_1_13","Q8_1_14","Q9","Q10_1","Q10_2","Q10_3","Q10_4","Q10_5","Q10_6","Q10_7","Q10_8","Q11","Q12","Q13_1","Q13_2","Q13_3","Q13_4","Q13_5","Q14","Q15_1","Q15_2","Q15_3","Q15_4","Q16_1","Q16_2","Q16_3","Q16_4","Q16_5","Q16_6","Q17","Q18_1","Q18_2","Q18_3","Q18_4","Q18_5","Q18_6","Q18_7","Q18_8","Q18_9","Q18_10","Q19","Q20","Q21_1","Q21_2","Q21_3","Q22_1","Q22_2","Q22_3","Q23_1","Q23_2","Q23_3","Q23_4","Q23_5","Q24_1","Q24_2","Q24_3","Q24_4","Q24_5","Q24_6","Q25_1","Q25_2","Q25_3","Q25_4","Q25_5","Q25_6","Q25_7","Q26","Q27_1","Q27_2","Q27_3","Q27_4","Q28","Q29","Q30_1","Q31","Q32","Q33","Q34","Q35_1","Q35_2","Q35_3","Q35_4","Q35_5","Q35_6","Q35_7","Q35_8","Q35_9","Q35_10","Q35_11","Q35_12","Q36_1","Q36_2","Q36_3","Q36_4","Q36_5","Q36_6","Q36_7","Q36_8","Q36_9","Q36_10","Q36_11","Q37","Q38","Q39")


admin <- c("Member.Age...as.of.date", "Member.Citizen", "Member.Sex", "Member.Ethnicity", "HH.Members.under.age.13", "Single.Parent.HH", "Total.Annual.Income")

```
### Age.
Member.Age...as.of.date
```{r, echo=FALSE}




all1 <- subset(all, F!="New") #!is.na(Member.Age...as.of.date_15))
all1$Member.Age...as.of.date15[is.na(all1$Member.Age...as.of.date15)] <- all1$Member.Age...as.of.date_15[is.na(all1$Member.Age...as.of.date15)]
Attr_15Median <- median(all1$Member.Age...as.of.date15[all1$F=="Out"], na.rm = TRUE)
Rest_15Median <- median(all1$Member.Age...as.of.date15[all1$F=="Core"], na.rm = TRUE)
med <- data.frame(F=c("Out", "Core"), m=c(Attr_15Median, Rest_15Median))
all1$med_15[all1$F=="Out"] <- Attr_15Median
all1$med_15[all1$F=="Core"] <- Rest_15Median
ggplot(all1, aes(x = all1$F, y = all1$Member.Age...as.of.date15)) + 
  geom_boxplot() +
  xlab("2015") + ylab("Member Age in 2015") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle("Comparison of Age as of 2015 \nfor \"out\" group (N=27) and the rest (N=88)\n")
all1 <- subset(all, F!="Out")
New17Median <- median(all1$'MemberAge-asofdate_17'[all1$F=="New"], na.rm = TRUE)
Rest17Median <- median(all1$'MemberAge-asofdate_17'[all1$F=="Core"], na.rm = TRUE)
all1$med17[all1$F=="New"] <- New17Median
all1$med17[all1$F=="Core"] <- Rest17Median
med <- data.frame(F=c("New", "Core"), m=c(New17Median, Rest17Median))
ggplot(all1, aes(x = all1$F, y = all1$'MemberAge-asofdate_17')) + 
  geom_boxplot() +
  xlab("2017") + ylab("Member Age in 2017") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle("Comparison of Age as of 2017 \nfor \"new\" group (N=27) and the \"core\" (N=88)\n")
  
#all1$'MemberAge-asofdate_17'[all1$F=="Core"]
#all1$'MemberAge-asofdate_17'[all1$F=="New"]
```


### Health questions.
Q3_4: Health issues - a barrier to SS in housing?
```{r, echo=FALSE}
for(i in c("Q3_4")) {
  x <- paste0("rest$", i, "_15", sep="")
  #print(c(x, length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  #print(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("rest$", i, "_17", sep="")
  #print(c(x, length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  #print(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("attrition$", i, "_15", sep="")
  #print(c(x, length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  #print(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("new$", i, "_17", sep="")
  #print(c(x, length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  #print(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
  x <- paste0("rest$", i, "_15", sep="")
  temp$N[1] <- length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])
  temp$PercentYes[1] <- 100*(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("rest$", i, "_17", sep="")
  temp$N[2] <- length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])
  temp$PercentYes[2] <- 100*(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("attrition$", i, "_15", sep="")
  temp$N[3] <- length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])
  temp$PercentYes[3] <- 100*(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  x <- paste0("new$", i, "_17", sep="")
  temp$N[4] <- length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])
  temp$PercentYes[4] <- 100*(summary(eval(parse(text = x)))[2]/(length(eval(parse(text = x))[!is.na(eval(parse(text = x)))])))
  
}

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q3_4: Health issues barrier to SS in housing?\n")


  
```


Q8_2:	Health problems - a barrier to employment?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q8_2"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q8_2:	Health problems - a barrier to employment?\n")


```

Q10_3: Very hard to pay for... health care for myself and my family?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q10_3"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q10_3: Very hard to pay for\nhealth care for myself and my family?\n")


```

Q18_2: Personal or family members’ health - a barrier to transportation?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q18_2"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q18_2: Personal or family members’ health\na barrier to transportation?\n")

```


Q29: How would you rate your current health?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q29"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported Poor or Quite Poor") +
  ggtitle("Q29: How would you rate your current health?\n")

```

Q35_11:	Health issues - a barrier to education?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q35_11"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q35_11:	Health issues - a barrier to education?\n")
```

Q36_9: Health Self Assessment
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q36_9"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported\nsituation is Urgent or Vulnerable") +
  ggtitle("Q36_9: Health Self Assessment\n")


```

### Employment
Q3_1: Not having a paying job - barrier to SS in housing
```{r, echo=FALSE}
temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q3_1"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q3_1: Not having a paying job\na barrier to SS in housing\n")
```


Q8_3: Lack of education or skills - a barrier to employment?
```{r, echo=FALSE}
temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q8_3"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q8_3: Lack of education or skills\na barrier to employment?\n")
```

Q5	Employment Status
```{r, echo=FALSE}


temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q5"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported\nemployed year-round full- or part-time") +
  ggtitle("Q5	Employment Status\n")

```

Q36_2	Employment Self Assessment
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q36_2"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported\nsituation is Urgent or Vulnerable") +
  ggtitle("Q36_2	Employment Self Assessment\n")
```

### Immigration questions
Q8_15: Immigration status - a barrier to SS in employment
```{r, echo=FALSE}


temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q8_14"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q8_15: Immigration status\na barrier to SS in employment?\n")

```

Q35_12: Immigration Status - a barrier to advance your education/skills?
```{r, echo=FALSE}
temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q35_12"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[2]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent Yes") +
  ggtitle("Q35_12: Immigration Status\n a barrier to advance your education/skills?\n")
```

Q36_11: Self Assessment of SS in immigration status
```{r, echo=FALSE, fig.height=5}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q36_11"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported\nsituation is Urgent or Vulnerable") +
  ggtitle("Q36_11: Self Assessment of SS in immigration status\n")

```

Member.Citizen
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Member.Citizen"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("as.factor(rest$", i, "_17)", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

x <- paste0("as.factor(new$", i, "_17)", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*((summary(x)[1] + summary(x)[2])/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported\nEligible Citizen or Eligible Non-Citizen") +
  ggtitle("Citizenship based on BHP administrative data\n")


```

### Total annual income

```{r, echo=FALSE}

all1 <- subset(all, F!="New" & !is.na(Total.Annual.Income15))
att_2015_N <- length(all1$Total.Annual.Income15[all1$F=="Out"])
rest_2015_N <- length(all1$Total.Annual.Income15[all1$F=="Core"])
Attr15Median <- median(all1$Total.Annual.Income15[all1$F=="Out"])
Rest15Median <- median(all1$Total.Annual.Income15[all1$F=="Core"])
med <- data.frame(F=c("Out", "Core"), m=c(Attr15Median, Rest15Median))
all1$med15[all1$F=="Out"] <- Attr15Median
all1$med15[all1$F=="Core"] <- Rest15Median
ggplot(all1, aes(x = all1$F, y = all1$Total.Annual.Income15)) + 
  geom_boxplot() +
  xlab("2015") + ylab("Total annual income in 2015") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Income as of 2015 \nfor \"out\" group (N=", att_2015_N, ") and the \"core\" (N=", rest_2015_N, ")\n", sep = ""))

all1 <- subset(all, F!="Out")
att_2017_N <- length(all1$TotalAnnualIncome_17[all1$F=="New"])
rest_2017_N <- length(all1$TotalAnnualIncome_17[all1$F=="Core"])
#all1$TotalAnnualIncome_17 <- gsub(",", "", all1$TotalAnnualIncome_17)
#all1$TotalAnnualIncome_17 <- as.numeric(all1$TotalAnnualIncome_17)
New17Median <- median(all1$TotalAnnualIncome_17[all1$F=="New"])
Rest17Median <- median(all1$TotalAnnualIncome_17[all1$F=="Core"])
all1$med17[all1$F=="New"] <- New17Median
all1$med17[all1$F=="Core"] <- Rest17Median
med <- data.frame(F=c("New", "Core"), m=c(New17Median, Rest17Median))
ggplot(all1, aes(x = all1$F, y = all1$TotalAnnualIncome_17)) + 
  geom_boxplot() +
  xlab("2017") + ylab("Total annual income in 2017") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Income as of 2017 \nfor \"out\" group (N=", att_2017_N, ") and the \"core\" (N=", rest_2017_N, ")\n", sep = ""))
  

```

### Tenant Rent

```{r, echo=FALSE}

all1 <- subset(all, F!="New" & !is.na(Total.Annual.Income15))
att_2015_N <- length(all1$Tenant.Rent15[all1$F=="Out"])
rest_2015_N <- length(all1$Tenant.Rent15[all1$F=="Core"])
Attr15Median <- median(all1$Tenant.Rent15[all1$F=="Out"])
Rest15Median <- median(all1$Tenant.Rent15[all1$F=="Core"])
med <- data.frame(F=c("Out", "Core"), m=c(Attr15Median, Rest15Median))
all1$med15[all1$F=="Out"] <- Attr15Median
all1$med15[all1$F=="Core"] <- Rest15Median
ggplot(all1, aes(x = all1$F, y = all1$Tenant.Rent15)) + 
  geom_boxplot() +
  xlab("2015") + ylab("Rent in 2015") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Rent as of 2015 \nfor \"out\" group (N=", att_2015_N, ") and the \"core\" (N=", rest_2015_N, ")\n", sep = ""))

all1 <- subset(all, F!="Out")
att_2017_N <- length(all1$TenantRent_17[all1$F=="New"])
rest_2017_N <- length(all1$TenantRent_17[all1$F=="Core"])
#all1$TenantRent_17 <- gsub(",", "", all1$TenantRent_17)
#all1$TenantRent_17 <- as.numeric(all1$TenantRent_17)
New17Median <- median(all1$TenantRent_17[all1$F=="New"])
Rest17Median <- median(all1$TenantRent_17[all1$F=="Core"])
all1$med17[all1$F=="New"] <- New17Median
all1$med17[all1$F=="Core"] <- Rest17Median
med <- data.frame(F=c("New", "Core"), m=c(New17Median, Rest17Median))
ggplot(all1, aes(x = all1$F, y = all1$TenantRent_17)) + 
  geom_boxplot() +
  xlab("2017") + ylab("Rent in 2017") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Rent as of 2017 \nfor \"out\" group (N=", att_2017_N, ") and the \"core\" (N=", rest_2017_N, ")\n", sep = ""))
  

```

### Number of Children

```{r, echo=FALSE}

all1 <- subset(all, F!="New" & !is.na(Total.Annual.Income15))
att_2015_N <- length(all1$HH.Members.under.age.1315[all1$F=="Out"])
rest_2015_N <- length(all1$HH.Members.under.age.1315[all1$F=="Core"])
Attr15Median <- median(all1$HH.Members.under.age.1315[all1$F=="Out"])
Rest15Median <- median(all1$HH.Members.under.age.1315[all1$F=="Core"])
Attr15Mean <- mean(as.integer(as.character(all1$HH.Members.under.age.1315))[all1$F=="Out"], na.rm = TRUE)
Rest15Mean <- mean(as.integer(as.character(all1$HH.Members.under.age.1315))[all1$F=="Core"], na.rm = TRUE)
med <- data.frame(F=c("Out", "Core"), m=c(Attr15Median, Rest15Median))
all1$med15[all1$F=="Out"] <- Attr15Median
all1$med15[all1$F=="Core"] <- Rest15Median
ggplot(all1, aes(x = all1$F, y = all1$HH.Members.under.age.1315)) + 
  geom_boxplot() +
  xlab("2015") + ylab("No. of Children under 13 in 2015") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Number of Children as of 2015 \nfor \"out\" group (N=", att_2015_N, ") and the \"core\" (N=", rest_2015_N, ")\n", sep = ""))

all1 <- subset(all, F!="Out")
att_2017_N <- length(all1$HHMembersunderage13_17[all1$F=="New"])
rest_2017_N <- length(all1$HHMembersunderage13_17[all1$F=="Core"])
#all1$HHMembersunderage13_17 <- gsub(",", "", all1$HHMembersunderage13_17)
#all1$HHMembersunderage13_17 <- as.numeric(all1$HHMembersunderage13_17)
New17Median <- median(all1$HHMembersunderage13_17[all1$F=="New"])
Rest17Median <- median(all1$HHMembersunderage13_17[all1$F=="Core"])
New17Mean <- mean(as.integer(as.character(all1$HHMembersunderage13_17))[all1$F=="New"], na.rm = TRUE)
Rest17Mean <- mean(as.integer(as.character(all1$HHMembersunderage13_17))[all1$F=="Core"], na.rm = TRUE)
all1$med17[all1$F=="New"] <- New17Median
all1$med17[all1$F=="Core"] <- Rest17Median
med <- data.frame(F=c("New", "Core"), m=c(New17Median, Rest17Median))
ggplot(all1, aes(x = all1$F, y = all1$HHMembersunderage13_17)) + 
  geom_boxplot() +
  xlab("2017") + ylab("No. of Children under 13 in 2017") +
  geom_text(data = med, aes(x=med$F, y=med$m, label=med$m, vjust = -0.5, hjust=0.5, color = "red")) + theme(legend.position="none") +
  ggtitle(paste0("Comparison of Number of Children as of 2017 \nfor \"out\" group (N=", att_2017_N, ") and the \"core\" (N=", rest_2017_N, ")\n", sep = ""))
  
print(c("Out-Movers 2015 average number of children", round(Attr15Mean, 1))) 
print(c("Core group 2015 average number of children", round(Rest15Mean, 1))) 
print(c("New group 2017 average number of children", round(New17Mean, 1))) 
print(c("Core group 2017 average number of children", round(Rest17Mean, 1)))
```




Q9: Income ran out last three months?
```{r, echo=FALSE}

temp <- data.frame(a = c("Core_15", "Core_17", "Out_15", "In_17"), N=c(NA, NA, NA, NA), PercentYes=c(NA, NA, NA, NA))
i <- "Q9"

x <- paste0("rest$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[1] <- length(x[!is.na(x)])
temp$PercentYes[1] <- 100*(summary(x)[1]/(length(x[!is.na(x)])))

x <- paste0("rest$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[2] <- length(x[!is.na(x)])
temp$PercentYes[2] <- 100*(summary(x)[1]/(length(x[!is.na(x)])))

x <- paste0("attrition$", i, "_15", sep="")
x <- eval(parse(text = x))
temp$N[3] <- length(x[!is.na(x)])
temp$PercentYes[3] <- 100*(summary(x)[1]/(length(x[!is.na(x)])))

x <- paste0("new$", i, "_17", sep="")
x <- eval(parse(text = x))
temp$N[4] <- length(x[!is.na(x)])
temp$PercentYes[4] <- 100*(summary(x)[1]/(length(x[!is.na(x)])))

ggplot(temp, aes(x=temp$a, y=(temp$PercentYes))) + geom_bar(stat="identity", fill="red", alpha=0.25) + 
  geom_text(aes(x=temp$a, y=(temp$PercentYes), label=paste(as.character(round(temp$PercentYes)), " (N = ", as.character(temp$N), ")", sep="")), vjust = "inward") + 
  xlab("") + ylab("Percent who reported Never") +
  ggtitle("Q9: Income ran out last three months?\n")


```

```{r, echo=FALSE}
#pander(data.frame(attrition$TCode, attrition$Total.Annual.Income14, attrition$Tenant.Rent14))

#pander(data.frame(new$TCode, new$Total.Annual.Income17, new$Tenant.Rent17))
#diff<-rest$Total.Annual.Income17-rest$Total.Annual.Income14
#temp <- data.frame(rest$TCode, rest$Total.Annual.Income14, rest$Total.Annual.Income17, diff)
#pander(temp)
#summary(temp$diff)
#temp <- subset(temp, rest.Total.Annual.Income14!=0)
#summary(temp$diff)

```


## ADMINISTRATIVE DATA
```{r, echo=FALSE}
levCitizen <- c("EC", "EN", "IN")
labCitizen <- c("Eligible Citizen", "Eligible Non-Citizen", "Ineligible Non-Citizen")

final$Member.Citizen14 <- factor(final$Member.Citizen14, levels=levCitizen, labels = labCitizen)
final$Member.Citizen_15 <- factor(final$Member.Citizen_15, levels=levCitizen, labels = labCitizen)

final$Member.Ethnicity14 <- as.factor(final$Member.Ethnicity14)
final$Member.Ethnicity15 <- as.factor(final$Member.Ethnicity15)

final$Member.Ethnicity14 <- factor(final$Member.Ethnicity14, levels = c(1, 2), labels=c("Hispanic/Latino", "Non-Hispanic/Latino"))
final$Member.Ethnicity15 <- factor(final$Member.Ethnicity15, levels = c(1, 2), labels=c("Hispanic/Latino", "Non-Hispanic/Latino"))

final$Bedrooms14 <- as.factor(final$Bedrooms14)
final$Bedrooms15 <- as.factor(final$Bedrooms15)

final$Family.Members14 <- as.factor(final$Family.Members14)
final$Family.Members15 <- as.factor(final$Family.Members15)

final$Eligible.Members14 <- as.factor(final$Eligible.Members14)
final$Eligible.Members15 <- as.factor(final$Eligible.Members15)

final$Dependants14 <- as.factor(final$Dependants14)
final$Dependants15 <- as.factor(final$Dependants15)

final$HH.Members.under.age.1314 <- as.factor(final$HH.Members.under.age.1314)
final$HH.Members.under.age.1315 <- as.factor(final$HH.Members.under.age.1315)

final$Student.Houshold.Members14 <- as.factor(final$Student.Houshold.Members14)


final$Non.Students.Ages.18.14 <- as.factor(final$Non.Students.Ages.18.14)


final$Bedrooms14 <- as.factor(final$Bedrooms14)
final$Bedrooms15 <- as.factor(final$Bedrooms15)

#summary(final$Status14)
#summary(final$Household.Member14)
#summary(final$Member.Age...as.of.date14)
#summary(final$Total.Annual.Income14)
#summary(final$Member.Citizen14)
#summary(final$Member.Sex14)
#summary(final$Tenant.Rent14)
#summary(final$Member.Ethnicity14)
#summary(final$Bedrooms14)
#summary(final$Family.Members14)
#summary(final$Eligible.Members14)
#summary(final$Dependants14)
#summary(final$HH.Members.under.age.1314)
#summary(final$Student.Houshold.Members14)
#summary(final$Non.Students.Ages.18.14)
#summary(final$Single.Parent.HH14)


#summary(final$Status15)
#summary(final$Household.Member15)
#summary(final$Member.Age...as.of.date15)
#summary(final$Total.Annual.Income15)
#summary(final$Member.Citizen15)
#summary(final$Member.Sex15)
#summary(final$Tenant.Rent15)
#summary(final$Member.Ethnicity15)
#summary(final$Bedrooms15)
#summary(final$Family.Members15)
#summary(final$Eligible.Members15)
#summary(final$Dependants15)
#summary(final$HH.Members.under.age.1315)
#summary(final$Student.Houshold.Members15)
#summary(final$Non.Students.Ages.18.15)
#summary(final$Single.Parent.HH15)
```


```{r, echo=FALSE}
#table(final$Status14, final$Status15)
```

Changes in Administrative data between 2014, 2015 and 2017.
```{r, message = FALSE, echo=FALSE, fig.height=10, fig.width=9}
x <- c("% Ineligible Non-Citizens",
       "% Female",
       "% Hispanic/Latino",
       "% living in 3 or more bedrooms",
       "% w/4 or more family members",
       "% w/2 or more dependents",
       "% w/1 or more HH members < 13yrs",
       "% Single parent household")


y_2014 <- c(median(final$Member.Age...as.of.date14, na.rm = TRUE), 
            median(final$Total.Annual.Income14, na.rm = TRUE),
            median(final$Tenant.Rent14, na.rm = TRUE))

pct_Yes_2014 <- c(100*length(final$Member.Citizen14[final$Member.Citizen14=="Ineligible Non-Citizen"& !is.na(final$Member.Citizen14)])/length(final$Member.Citizen14[!is.na(final$Member.Citizen14)]),
                  100*length(final$Member.Sex14[final$Member.Sex14=="F" & !is.na(final$Member.Sex14)] )/length(final$Member.Sex14[!is.na(final$Member.Sex14)]),
                  100*length(final$Member.Ethnicity14[final$Member.Ethnicity14=="Hispanic/Latino" & !is.na(final$Member.Ethnicity14)])/length(final$Member.Ethnicity14[!is.na(final$Member.Ethnicity14)]),
                  100*length(final$Bedrooms14[as.integer(as.character(final$Bedrooms14))>=3 & !is.na(final$Bedrooms14)])/length(final$Bedrooms14[!is.na(final$Bedrooms14)]),
                  100*length(final$Family.Members14[as.integer(as.character(final$Family.Members14))>=4 & !is.na(final$Family.Members14)])/length(final$Family.Members14[!is.na(final$Family.Members14)]),
                  100*length(final$Dependants14[as.integer(as.character(final$Dependants14))>=2 & !is.na(final$Dependants14)])/length(final$Dependants14[!is.na(final$Dependants14)]),
                  100*length(final$HH.Members.under.age.1314[as.integer(as.character(final$HH.Members.under.age.1314))>=1 & !is.na(final$HH.Members.under.age.1314)])/length(final$HH.Members.under.age.1314[!is.na(final$HH.Members.under.age.1314)]),
                  100*length(final$Single.Parent.HH14[final$Single.Parent.HH14=="Yes" & !is.na(final$Single.Parent.HH14)])/length(final$Single.Parent.HH14[!is.na(final$Single.Parent.HH14)])
                  )

pct_Yes_2015 <- c(100*length(final$Member.Citizen_15[final$Member.Citizen_15=="Ineligible Non-Citizen"& !is.na(final$Member.Citizen_15)])/length(final$Member.Citizen_15[!is.na(final$Member.Citizen_15)]),
                  100*length(final$Member.Sex15[final$Member.Sex15=="F" & !is.na(final$Member.Sex15)] )/length(final$Member.Sex15[!is.na(final$Member.Sex15)]),
                  100*length(final$Member.Ethnicity15[final$Member.Ethnicity15=="Hispanic/Latino" & !is.na(final$Member.Ethnicity15)])/length(final$Member.Ethnicity15[!is.na(final$Member.Ethnicity15)]),
                  100*length(final$Bedrooms15[as.integer(as.character(final$Bedrooms15))>=3 & !is.na(final$Bedrooms15)])/length(final$Bedrooms15[!is.na(final$Bedrooms15)]),
                  100*length(final$Family.Members15[as.integer(as.character(final$Family.Members15))>=4 & !is.na(final$Family.Members15)])/length(final$Family.Members15[!is.na(final$Family.Members15)]),
                  100*length(final$Dependants15[as.integer(as.character(final$Dependants15))>=2 & !is.na(final$Dependants15)])/length(final$Dependants15[!is.na(final$Dependants15)]),
                  100*length(final$HH.Members.under.age.1315[as.integer(as.character(final$HH.Members.under.age.1315))>=1 & !is.na(final$HH.Members.under.age.1315)])/length(final$HH.Members.under.age.1315[!is.na(final$HH.Members.under.age.1315)]),
                  100*length(final$Single.Parent.HH15[final$Single.Parent.HH15=="Yes" & !is.na(final$Single.Parent.HH15)])/length(final$Single.Parent.HH15[!is.na(final$Single.Parent.HH15)])
                  )

final$Member.Citizen_17 <- NA
for(i in 1:length(final$TCode)) {
  if(final$TCode[i] %in% admin2017$Tenant) final$Member.Citizen_17[i] <- as.character(admin2017$Member.Citizen[as.character(admin2017$Tenant)==as.character(final$TCode[i])])
}

final$Member.Citizen_17 <-as.factor(final$Member.Citizen_17) 

pct_Yes_2017 <- c(100*length(final$Member.Citizen_17[final$Member.Citizen_17=="IN" & !is.na(final$Member.Citizen_17)])/length(final$Member.Citizen_17[!is.na(final$Member.Citizen_17)]),
                  100*length(final$MemberSex_17[final$MemberSex_17=="F" & !is.na(final$MemberSex_17)] )/length(final$MemberSex_17[!is.na(final$MemberSex_17)]),
                  100*length(final$MemberEthnicity_17[final$MemberEthnicity_17==1 & !is.na(final$MemberEthnicity_17)])/length(final$MemberEthnicity_17[!is.na(final$MemberEthnicity_17)]),
                  100*length(final$Bedrooms_17[as.integer(as.character(final$Bedrooms_17))>=3 & !is.na(final$Bedrooms_17)])/length(final$Bedrooms_17[!is.na(final$Bedrooms_17) & as.integer(as.character(final$Bedrooms_17))!=0]),
                  100*length(final$NumberofFamilyMembers_17[as.integer(as.character(final$NumberofFamilyMembers_17))>=4 & !is.na(final$NumberofFamilyMembers_17)])/length(final$NumberofFamilyMembers_17[!is.na(final$NumberofFamilyMembers_17)]),
                  100*length(final$NumberofDependents_17[as.integer(as.character(final$NumberofDependents_17))>=2 & !is.na(final$NumberofDependents_17)])/length(final$NumberofDependents_17[!is.na(final$NumberofDependents_17)]),
                  100*length(final$HHMembersunderage13_17[as.integer(as.character(final$HHMembersunderage13_17))>=1 & !is.na(final$HHMembersunderage13_17)])/length(final$HHMembersunderage13_17[!is.na(final$HHMembersunderage13_17)]),
                  100*length(final$SingleParentHousehold_17[final$SingleParentHousehold_17=="Yes" & !is.na(final$SingleParentHousehold_17)])/length(final$SingleParentHousehold_17[!is.na(final$SingleParentHousehold_17)])
                  )

d <- data.frame(Question = x, pct_Yes_2014, pct_Yes_2015, pct_Yes_2017)
d <- melt(d, id.vars = "Question", variable.name="Year", value.name="Percent_Yes")

ggplot(d, aes((Question), Percent_Yes, group=Year)) + geom_bar(stat = "identity", width = 0.7, position="dodge", aes(fill=Year), alpha=0.7) +
  theme(
    plot.title = element_text(size=16, face="bold", vjust=3), 
    axis.text.x = element_text(size=12, angle = 0, hjust = 1), 
    axis.text.y = element_text(size=12), 
    axis.title.x = element_text(size=12), 
    axis.title.y = element_text(size=12, vjust=2),
    legend.title=element_blank(),
    legend.text = element_text(size = 12)) +
  coord_flip() +
  ylab("\nPercentage ") +
  xlab(" ") +
  ggtitle("Socioeconomic and household characteristics\n") +
  geom_text(aes(y = Percent_Yes, label=round(Percent_Yes, 0)), stat="identity", position=position_dodge(width = 0.7), hjust="inward", vjust="inward", size=5, alpha=0.8) +
  scale_fill_manual(values = c("darkgreen", "cadetblue", "lightblue"), name="", labels = c("2014", "2015", "2017"))
```

